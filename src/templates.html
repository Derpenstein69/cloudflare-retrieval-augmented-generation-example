<!-- Common styles and scripts that are shared across templates -->
<template id="common-head">
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
</template>

<!-- Common navigation -->
<template id="nav-template">
  <p>
    <small>
      <a href="/ui">Query</a> ・ <a href="/notes">Notes</a> ・ <a href="/write">Add note</a>
    </small>
  </p>
</template>

<!-- UI Template -->
<template id="ui-template">
  <!DOCTYPE html>
  <html>
  <head>
    ${common-head}
    <title>Chat | Cloudflare RAG Example</title>
    <script src="https://unpkg.com/htmx.org/dist/htmx.js"></script>
  </head>
  <body>
    <h1>Retrieval Augmented Generation (RAG) Example</h1>
    ${nav-template}
    <form hx-get="/" hx-trigger="submit" hx-target="#result">
      <textarea name="text" required placeholder="Ask the AI anything"></textarea>
      <button type="submit">Submit</button>
    </form>
    <p id="result"></p>
  </body>
  </html>
</template>

<!-- Notes Template -->
<template id="notes-template">
  <!DOCTYPE html>
  <html>
  <head>
    ${common-head}
    <title>Notes | Cloudflare RAG Example</title>
    <script src="https://unpkg.com/mustache@latest"></script>
    <script src="https://unpkg.com/htmx.org/dist/htmx.js"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/client-side-templates.js"></script>
  </head>
  <body>
    <h1>Notes</h1>
    ${nav-template}
    <div
      hx-ext="client-side-templates"
      hx-get="/notes.json"
      hx-trigger="load"
      hx-swap="innerHTML"
      hx-target="#notes"
      mustache-array-template="note">
      <template id="note">
        {{#data}}
        <div class="note">
          <h2>Note #{{id}}</h2>
          <p>{{text}}</p>
          <form method="POST" action="/notes/{{id}}">
            <input type="hidden" name="_method" value="DELETE">
            <button type="submit">Delete</button>
          </form>
        </div>
        {{/data}}
      </template>
      <div id="notes"></div>
    </div>
  </body>
  </html>
</template>

<!-- Write Template -->
<template id="write-template">
  <!DOCTYPE html>
  <html>
  <head>
    ${common-head}
    <title>Write | Cloudflare RAG Example</title>
  </head>
  <body>
    <h1>Write a new note</h1>
    ${nav-template}
    <form id="write-form">
      <textarea name="text" required placeholder="Write a new note to add to the AI's knowledge base"></textarea>
      <button type="submit">Submit</button>
    </form>
    <script>
      document.getElementById('write-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const text = e.target.querySelector('textarea').value;
        try {
          const response = await fetch('/notes', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ text })
          });
          if (response.ok) {
            window.location.href = '/ui';
          } else {
            throw new Error('Failed to create note');
          }
        } catch (err) {
          alert(err.message);
        }
      });
    </script>
  </body>
  </html>
</template>
